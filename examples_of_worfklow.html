<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Workflow examples &mdash; sphinx 2.7 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="sphinx 2.7 documentation" href="index.html" />
    <link rel="next" title="List of tasks" href="list_of_tasks.html" />
    <link rel="prev" title="Functions" href="functions.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="list_of_tasks.html" title="List of tasks"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="functions.html" title="Functions"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">sphinx 2.7 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="workflow-examples">
<h1>Workflow examples<a class="headerlink" href="#workflow-examples" title="Permalink to this headline">Â¶</a></h1>
<p>Let&#8217;s find out whether the simulation reproduces results from the litterature. In particular, let&#8217;s look at the probability for the system to percolate, given a certain number of wires. This probability would depend on the sample size and the wire length, surely. Therefore, a scale-free characterization of the density, <span class="math">\(n\)</span>, of wires is, given a wire length <span class="math">\(l_w\)</span>, and sample length <span class="math">\(L\)</span>, width <span class="math">\(W\)</span>, and wire number <span class="math">\(N\)</span></p>
<div class="math">
\[n = \frac{N}{L/l_w \cdot W/l_w} = \frac{Nl_w^2}{L\cdot W}\]</div>
<p>This scale free density, <span class="math">\(n\)</span> is the number of wires on average present in a square whose side is equal to a wire length. Therefore, finite-size effects apart, the probability <span class="math">\(P(n)\)</span> for the system to percolate at a density <span class="math">\(n\)</span> of wires is now a sample-size / wire-size free measurement.</p>
<p>The article: <a class="reference external" href="http://arxiv.org/pdf/1110.0629.pdf">http://arxiv.org/pdf/1110.0629.pdf</a> finds the critical scale-free density of wires at which the percolation happens to be n=5.63</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">resistor_exercise</span> <span class="kn">as</span> <span class="nn">res_exercise</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">variable_wire_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="c"># n between 2 and 10 in this case.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sample_length</span> <span class="o">=</span> <span class="mf">50.</span> <span class="c">#microns</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sample_width</span> <span class="o">=</span> <span class="mf">50.</span> <span class="c">#microns</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wire_length</span><span class="o">=</span><span class="mf">5.</span> <span class="c">#microns</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">number_of_repetitions</span> <span class="o">=</span> <span class="mi">20</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">simulated_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">number_of_repetitions</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">variable_wire_num</span><span class="p">))</span> <span class="p">)</span> <span class="c">#vertically for repetitions, horizontally for different wire numbers</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_repetitions</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">nwires</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variable_wire_num</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">sample</span><span class="o">=</span><span class="n">res_exercise</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="n">sample_length</span><span class="p">,</span><span class="n">sample_width</span><span class="p">,</span><span class="n">nwires</span><span class="p">,</span><span class="n">wire_length</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">tu</span><span class="p">,</span><span class="n">p_idx</span><span class="p">,</span><span class="n">percolates</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">measure_percolation</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">if</span> <span class="n">percolates</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">simulated_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">index</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span> <span class="c">#for plotting</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="kn">as</span> <span class="nn">mpl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;text.usetex&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="s">&#39;font.size&#39;</span><span class="p">:</span><span class="mf">24.0</span><span class="p">,</span> <span class="s">&#39;font.family&#39;</span><span class="p">:</span> <span class="s">&#39;serif&#39;</span><span class="p">,</span> <span class="s">&#39;font.serif&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Computer Modern&#39;</span><span class="p">]})</span>
<span class="go">#nice plots</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span> <span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">variable_wire_num</span><span class="o">*</span><span class="n">wire_length</span><span class="o">*</span><span class="n">wire_length</span><span class="o">/</span><span class="n">sample_length</span><span class="o">/</span><span class="n">sample_width</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">simulated_data</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Percolation Probability&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">r&#39;Wire density $N\cdot l_w^2/[L\cdot W]$&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">results_folder_path</span><span class="o">+</span><span class="s">&#39;Percolation.png&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mf">5.63</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;dashed&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">5.83</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="s">r&#39;$n_c$&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/Percolation.png" src="_images/Percolation.png" />
<div class="section" id="making-the-workflow-better-optional">
<h2>Making the workflow better (Optional).<a class="headerlink" href="#making-the-workflow-better-optional" title="Permalink to this headline">Â¶</a></h2>
<p>Let&#8217;s say we simulated the results, which could take a long time, and we go drink a coffee and the computer shuts down, but we do not want to exceed more than 10 hours on this bonus exercise so it is really annoying to simulate everything again.</p>
<p>We need to :</p>
<ul class="simple">
<li>Define a working folder in which to store the results</li>
<li>Make sure we do not erase this folder / create a new folder every time at startup</li>
<li>Save the results of the simulations into some file format</li>
<li>Check everytime whether the saved result already exists in the results&#8217; folder</li>
<li>If it doesn&#8217;t exist, run the simulations. If it does exist, skip the simulation and load the result from the saved file.</li>
</ul>
<dl class="docutils">
<dt><strong>Preamble</strong> :</dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c">#core packages</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">resistor_exercise</span> <span class="kn">as</span> <span class="nn">res_exercise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># for plotting</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="kn">as</span> <span class="nn">mpl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># os, i/o</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># to display the plots inside of the notebook</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># nice plots</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;font.size&#39;</span><span class="p">:</span><span class="mf">24.0</span><span class="p">,</span> <span class="s">&#39;font.family&#39;</span><span class="p">:</span> <span class="s">&#39;serif&#39;</span><span class="p">,</span> <span class="s">&#39;font.serif&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Computer Modern&#39;</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">current_working_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results_directory_path</span> <span class="o">=</span> <span class="n">current_working_directory</span> <span class="o">+</span> <span class="s">&#39;/results/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">results_directory_path</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c"># create a results directory in the directory where this notebook is located, except if it already exists</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">results_directory_path</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p>At this point we have created a results folder in the current folder (the folder where the notebook is located). This folder is only created if it does not exist.</p>
<dl class="docutils">
<dt><strong>Window for executing the simulation</strong>:</dt>
<dd><div class="first highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c">#Window of execution</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Window of execution</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name_of_the_experiment</span> <span class="o">=</span> <span class="s">&#39;percolation_curve&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#Data will be stored into a file with that name</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output_file_name</span> <span class="o">=</span> <span class="n">results_directory_path</span> <span class="o">+</span> <span class="n">name_of_the_experiment</span> <span class="o">+</span> <span class="s">&#39;.pkl&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">variable_wire_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sample_length</span> <span class="o">=</span> <span class="mf">50.</span> <span class="c">#microns</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sample_width</span> <span class="o">=</span> <span class="mf">50.</span> <span class="c">#microns</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wire_length</span><span class="o">=</span><span class="mf">5.</span> <span class="c">#microns</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">number_of_repetitions</span> <span class="o">=</span> <span class="mi">20</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_stocker_name</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c">#simulation starts</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">simulated_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">number_of_repetitions</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">variable_wire_num</span><span class="p">))</span> <span class="p">)</span> <span class="c">#vertically for repetitions, horizontally for different wire numbers</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_repetitions</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">nwires</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variable_wire_num</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">sample</span><span class="o">=</span><span class="n">res_exercise</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="n">sample_length</span><span class="p">,</span><span class="n">sample_width</span><span class="p">,</span><span class="n">nwires</span><span class="p">,</span><span class="n">wire_length</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">_</span><span class="p">,</span><span class="n">p_idx</span><span class="p">,</span><span class="n">percolates</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">measure_percolation</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="k">if</span> <span class="n">percolates</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="n">simulated_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">index</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file_name</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span> <span class="c"># opens the file in write mode.</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">simulated_data</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">else</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c">#we simply read the data we have already computed.</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">simulated_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p>We give this <em>experiment</em> a name to be able to track the data better. We then create the path where to save an h5 table, which is a convenient file format. Then, the same definitions follow. After, we execute the simulation block only if the h5 table doesn&#8217;t exist yet (the simulation was never performed). After the simulation is done, the simulation data is stored into the h5 table and saved into its defined location. Next time we execute this window, the h5 table would exist, the simulation would be skipped, and the simulation data would be directly loaded from the h5 table.</p>
<dl class="docutils">
<dt><strong>Window for plotting</strong></dt>
<dd><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c">#Window for plotting</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span> <span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">variable_wire_num</span><span class="o">*</span><span class="n">wire_length</span><span class="o">*</span><span class="n">wire_length</span><span class="o">/</span><span class="n">sample_length</span><span class="o">/</span><span class="n">sample_width</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">simulated_data</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Percolation Probability&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">r&#39;Wire density $N\cdot l_w^2/[L\cdot W]$&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mf">5.63</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;dashed&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">5.83</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="s">r&#39;$n_c$&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">results_folder_path</span><span class="o">+</span><span class="s">&#39;Percolation.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="another-example-varying-the-aspect-ratio">
<h2>Another example: varying the aspect ratio<a class="headerlink" href="#another-example-varying-the-aspect-ratio" title="Permalink to this headline">Â¶</a></h2>
<p>Let&#8217;s investigate a system with a density higher than the percolation threshold. Then, the width of the sample is veried between 1 to 5 sample lengths while keeping the wire <em>density</em> constant.</p>
<p>One can take the previous workflow, change the name of the experiment, change a bit the simulation part, and that&#8217;s it.</p>
<dl class="docutils">
<dt><strong>Window of execution</strong></dt>
<dd><div class="first highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c">#Window of execution</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name_of_the_experiment</span> <span class="o">=</span> <span class="s">&#39;resistance_aspect_ratio&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output_file_name</span> <span class="o">=</span> <span class="n">results_directory_path</span><span class="o">+</span><span class="n">name_of_the_experiment</span><span class="o">+</span><span class="s">&#39;.pkl&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">variable_wire_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="mi">5000</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sample_length</span> <span class="o">=</span> <span class="mf">50.</span> <span class="c">#microns</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">variable_sample_width</span> <span class="o">=</span> <span class="mf">50.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span> <span class="c">#microns</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wire_length</span><span class="o">=</span><span class="mf">5.</span> <span class="c">#microns</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">number_of_repetitions</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">linear_res</span><span class="o">=</span><span class="mf">1.59</span> <span class="c">#value for silver</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">contact_res</span><span class="o">=</span><span class="mf">100.</span> <span class="c">#Ohm</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_file_name</span><span class="p">):</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span>    <span class="n">simulated_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">number_of_repetitions</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">variable_wire_num</span><span class="p">))</span> <span class="p">)</span> <span class="c">#vertically for repetitions, horizontally for different wire numbers</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_repetitions</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">sampwidth</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variable_sample_width</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c">#we need to increase the wire density so that the overall density stays the same</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">sample</span><span class="o">=</span><span class="n">res_exercise</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="n">sample_length</span><span class="p">,</span><span class="n">sampwidth</span><span class="p">,</span><span class="n">variable_wire_num</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">wire_length</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="k">try</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="c">#might not percolate all the time..</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="n">sample</span><span class="o">.</span><span class="n">calculate_res_system</span><span class="p">(</span><span class="n">linear_res</span><span class="p">,</span><span class="mf">0.03</span><span class="p">,</span><span class="n">contact_res</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>                <span class="n">simulated_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">index</span><span class="p">]</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">res_system</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="k">except</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>                 <span class="k">continue</span>
</pre></div>
</div>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file_name</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span> <span class="c"># opens the file in write mode.</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">simulated_data</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">else</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c">#we simply read the data we have already computed.</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">simulated_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><strong>Window of Plotting</strong></dt>
<dd><div class="first highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c">#fitting the data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x_axis</span> <span class="o">=</span> <span class="n">variable_sample_width</span><span class="o">/</span><span class="n">sample_length</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">simulated_data</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fitfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c">#a 1/x function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">errfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fitfunc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span><span class="n">y</span><span class="p">)</span> <span class="c"># Distance to the target function</span>
</pre></div>
</div>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="mf">1.</span><span class="p">]</span> <span class="c">#initial guess of the parameters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="n">errfunc</span><span class="p">,</span> <span class="n">p0</span><span class="p">[:],</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span><span class="n">y_axis</span><span class="p">))</span> <span class="c">#solved least squares</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#plotting the data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">variable_sample_width</span><span class="o">/</span><span class="n">sample_length</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">simulated_data</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">simulated_data</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span><span class="n">fitfunc</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">x_axis</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Width over length of sample&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">r&#39;Resistance $[\Omega]$&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;Simulated data&#39;</span><span class="p">,</span><span class="s">r&#39;$R(x)\simeq \frac{1}{x}$&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">results_directory_path</span><span class="o">+</span><span class="s">&#39;Resistance_in_aspect_ratio.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<img alt="_images/Resistance_in_aspect_ratio.png" src="_images/Resistance_in_aspect_ratio.png" />
<p>What do you think, does this result <strong>make sense</strong> ?</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Workflow examples</a><ul>
<li><a class="reference internal" href="#making-the-workflow-better-optional">Making the workflow better (Optional).</a></li>
<li><a class="reference internal" href="#another-example-varying-the-aspect-ratio">Another example: varying the aspect ratio</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="functions.html"
                        title="previous chapter">Functions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="list_of_tasks.html"
                        title="next chapter">List of tasks</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/examples_of_worfklow.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="list_of_tasks.html" title="List of tasks"
             >next</a> |</li>
        <li class="right" >
          <a href="functions.html" title="Functions"
             >previous</a> |</li>
        <li><a href="index.html">sphinx 2.7 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, forro.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>